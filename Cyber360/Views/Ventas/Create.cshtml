@model Cyber360.Models.Venta

@{
    ViewData["Title"] = "Nueva Venta";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    :root {
        --cyber-blue: #0066cc;
        --cyber-dark: #111;
        --cyber-gray: #333;
        --cyber-light: #ddd;
        --cyber-accent: #ff6600;
        --cr-screen: #c0ffc0;
    }

    body {
        background-color: var(--cyber-dark);
        color: var(--cyber-light);
        font-family: 'Courier New', monospace;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100" opacity="0.03"><rect width="100" height="100" fill="%230066cc"/></svg>');
        margin: 0;
        padding: 20px;
    }

    .cyber-container {
        max-width: 1200px;
        margin: 0 auto;
        border: 3px solid var(--cyber-blue);
        padding: 20px;
        background-color: var(--cyber-gray);
        box-shadow: 0 0 20px rgba(0, 102, 204, 0.5);
    }

    .cyber-header {
        color: var(--cyber-accent);
        border-bottom: 2px dashed var(--cyber-blue);
        padding-bottom: 10px;
        margin-bottom: 20px;
        font-size: 1.8rem;
        text-transform: uppercase;
    }

    .cyber-form {
        background-color: var(--cyber-dark);
        padding: 20px;
        border: 1px solid var(--cyber-blue);
        box-shadow: 0 0 10px rgba(0, 102, 204, 0.3);
    }

    .cyber-card {
        background-color: #1a1a1a;
        border: 1px solid var(--cyber-blue);
        margin-bottom: 20px;
        box-shadow: 0 0 8px rgba(0, 102, 204, 0.2);
    }

    .cyber-card-header {
        background-color: var(--cyber-blue);
        color: white;
        padding: 10px 15px;
        border-bottom: 1px solid var(--cyber-accent);
        font-weight: bold;
    }

    .cyber-card-body {
        padding: 15px;
    }

    .cyber-label {
        color: var(--cyber-accent);
        font-weight: bold;
        margin-bottom: 5px;
        display: block;
    }

    .cyber-input {
        background-color: var(--cyber-dark);
        color: var(--cr-screen);
        border: 1px solid var(--cyber-blue);
        padding: 8px 12px;
        width: 100%;
        font-family: 'Courier New', monospace;
        margin-bottom: 10px;
    }

        .cyber-input:focus {
            outline: none;
            border-color: var(--cyber-accent);
            box-shadow: 0 0 8px var(--cyber-accent);
        }

    .cyber-select {
        background-color: var(--cyber-dark);
        color: var(--cr-screen);
        border: 1px solid var(--cyber-blue);
        padding: 8px 12px;
        width: 100%;
        font-family: 'Courier New', monospace;
    }

    .cyber-btn {
        display: inline-block;
        padding: 8px 15px;
        margin: 5px;
        border: none;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
    }

    .cyber-btn-primary {
        background-color: var(--cyber-blue);
        color: white;
    }

        .cyber-btn-primary:hover {
            background-color: #004080;
            box-shadow: 0 0 10px var(--cyber-blue);
        }

    .cyber-btn-secondary {
        background-color: var(--cyber-gray);
        color: var(--cyber-light);
        border: 1px solid var(--cyber-blue);
    }

        .cyber-btn-secondary:hover {
            background-color: var(--cyber-dark);
            box-shadow: 0 0 10px var(--cyber-blue);
        }

    .cyber-alert {
        padding: 10px 15px;
        margin-bottom: 15px;
        border-left: 3px solid;
    }

    .cyber-alert-danger {
        background-color: rgba(255, 0, 0, 0.1);
        border-left-color: #ff0000;
        color: #ff6666;
    }

    .cyber-text-muted {
        color: #666;
        font-size: 0.8rem;
    }

    .cr-effect {
        color: var(--cr-screen);
        text-shadow: 0 0 5px var(--cr-screen);
    }

    .pixel-border {
        border: 2px solid var(--cyber-blue);
        position: relative;
    }

        .pixel-border:before {
            content: "";
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 1px solid var(--cyber-accent);
            pointer-events: none;
        }

    .status-light {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
    }

    .status-on {
        background-color: #00ff00;
        box-shadow: 0 0 5px #00ff00;
    }
</style>


<div class="cyber-container pixel-border">
    <div class="d-flex justify-content-between align-items-center">
        <h1 class="cyber-header">
            <i class="fas fa-cash-register"></i> REGISTRO DE VENTAS
        </h1>
        <div class="text-right">
            <span class="cr-effect">Transacción v1.42</span><br>
            <span class="status-light status-on"></span>
            <small class="cr-effect">Sistema activo</small>
        </div>
    </div>

    <div class="cyber-form mt-4">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="cyber-alert cyber-alert-danger">
                <i class="fas fa-exclamation-triangle"></i> ERRORES EN EL FORMULARIO
            </div>

            <div class="cyber-grid">
                <!-- Sección Cliente -->
                <div class="cyber-card cyber-card-highlight">
                    <div class="cyber-card-header">
                        <i class="fas fa-user-tag"></i> DATOS DEL CLIENTE
                    </div>
                    <div class="cyber-card-body">
                        <div class="cyber-form-group">
                            <label asp-for="ClienteId" class="cyber-label">
                                <i class="fas fa-id-card"></i> SELECCIONE CLIENTE
                            </label>
                            <select asp-for="ClienteId" class="cyber-select" asp-items="ViewBag.ClienteId">
                                <option value="">-- [Seleccione] --</option>
                            </select>
                            <span asp-validation-for="ClienteId" class="text-danger cyber-error"></span>
                        </div>
                    </div>
                </div>

                <!-- Sección Producto/Servicio -->
                <div class="cyber-dual-section">
                    <!-- Producto -->
                    <div class="cyber-card">
                        <div class="cyber-card-header cyber-card-product">
                            <i class="fas fa-box-open"></i> PRODUCTO
                        </div>
                        <div class="cyber-card-body">
                            <div class="cyber-form-group">
                                <label asp-for="ProductoId" class="cyber-label">
                                    <i class="fas fa-barcode"></i> SELECCIONE PRODUCTO
                                </label>
                                <select asp-for="ProductoId" class="cyber-select" asp-items="ViewBag.ProductoId" id="productoSelect">
                                    <option value="">-- [Ninguno] --</option>
                                </select>
                                <span asp-validation-for="ProductoId" class="text-danger cyber-error"></span>
                            </div>

                            <div class="cyber-form-group">
                                <label asp-for="Cantidad" class="cyber-label">
                                    <i class="fas fa-calculator"></i> CANTIDAD
                                </label>
                                <input asp-for="Cantidad" class="cyber-input" min="1" value="1" disabled />
                                <span asp-validation-for="Cantidad" class="text-danger cyber-error"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Servicio -->
                    <div class="cyber-card">
                        <div class="cyber-card-header cyber-card-service">
                            <i class="fas fa-laptop-code"></i> SERVICIO
                        </div>
                        <div class="cyber-card-body">
                            <div class="cyber-form-group">
                                <label asp-for="ServicioId" class="cyber-label">
                                    <i class="fas fa-wifi"></i> SELECCIONE SERVICIO
                                </label>
                                <select asp-for="ServicioId" class="cyber-select" asp-items="ViewBag.ServicioId" id="servicioSelect">
                                    <option value="">-- [Ninguno] --</option>
                                </select>
                                <span asp-validation-for="ServicioId" class="text-danger cyber-error"></span>
                            </div>

                            <div class="cyber-form-group">
                                <label asp-for="CantidadServicio" class="cyber-label">
                                    <i class="fas fa-clock"></i> DURACIÓN (HORAS)
                                </label>
                                <input asp-for="CantidadServicio" class="cyber-input" min="1" value="1" disabled />
                                <span asp-validation-for="CantidadServicio" class="text-danger cyber-error"></span>
                                <small class="cyber-text-muted">Tiempo estimado en horas</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resumen -->
                <div class="cyber-card cyber-card-summary">
                    <div class="cyber-card-header">
                        <i class="fas fa-file-invoice-dollar"></i> RESUMEN DE TRANSACCIÓN
                    </div>
                    <div class="cyber-card-body">
                        <div class="cyber-summary-item">
                            <span class="cyber-summary-label">Cliente:</span>
                            <span class="cyber-summary-value cr-effect" id="clientePreview">[No seleccionado]</span>
                        </div>
                        <div class="cyber-summary-item">
                            <span class="cyber-summary-label">Producto:</span>
                            <span class="cyber-summary-value cr-effect" id="productoPreview">[Ninguno]</span>
                        </div>
                        <div class="cyber-summary-item">
                            <span class="cyber-summary-label">Servicio:</span>
                            <span class="cyber-summary-value cr-effect" id="servicioPreview">[Ninguno]</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cyber-form-actions">
                <button type="submit" class="cyber-btn cyber-btn-primary cyber-btn-lg">
                    <i class="fas fa-check-circle"></i> CONFIRMAR VENTA
                </button>
                <a asp-action="Index" class="cyber-btn cyber-btn-secondary">
                    <i class="fas fa-times-circle"></i> CANCELAR
                </a>
            </div>
        </form>
    </div>

    <div class="cyber-footer mt-4">
        <div class="d-flex justify-content-between">
            <div>
                <span class="cr-effect">F1-Ayuda</span> | 
                <span class="cr-effect">F2-Clientes</span> | 
                <span class="cr-effect">F5-Actualizar</span>
            </div>
            <div>
                <span class="cr-effect">@DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss")</span>
            </div>
            <div>
                <span class="cr-effect">Sistema CyberCafé v3.1</span>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos del formulario
            const productoSelect = document.getElementById('productoSelect');
            const servicioSelect = document.getElementById('servicioSelect');
            const cantidadProducto = document.querySelector('input[name="Cantidad"]');
            const cantidadServicio = document.querySelector('input[name="CantidadServicio"]');
            
            // Elementos de vista previa
            const clienteSelect = document.querySelector('select[name="ClienteId"]');
            const clientePreview = document.getElementById('clientePreview');
            const productoPreview = document.getElementById('productoPreview');
            const servicioPreview = document.getElementById('servicioPreview');

            // Actualizar vista previa
            function updatePreviews() {
                // Vista previa del cliente
                const selectedCliente = clienteSelect.options[clienteSelect.selectedIndex].text;
                clientePreview.textContent = selectedCliente || '[No seleccionado]';
                
                // Vista previa del producto
                const selectedProducto = productoSelect.options[productoSelect.selectedIndex].text;
                productoPreview.textContent = selectedProducto || '[Ninguno]';
                
                // Vista previa del servicio
                const selectedServicio = servicioSelect.options[servicioSelect.selectedIndex].text;
                servicioPreview.textContent = selectedServicio || '[Ninguno]';
            }

            // Habilitar/deshabilitar campos según selección
            function updateFormState() {
                // Productos
                const hasProduct = productoSelect.value && productoSelect.value !== "";
                cantidadProducto.disabled = !hasProduct;
                if (!hasProduct) cantidadProducto.value = "";

                // Servicios
                const hasService = servicioSelect.value && servicioSelect.value !== "";
                cantidadServicio.disabled = !hasService;
                if (!hasService) cantidadServicio.value = "";
                
                updatePreviews();
            }

            // Event listeners
            productoSelect.addEventListener('change', updateFormState);
            servicioSelect.addEventListener('change', updateFormState);
            clienteSelect.addEventListener('change', updatePreviews);

            // Validación de cantidades mínimas
            cantidadProducto.addEventListener('change', function() {
                if (this.value < 1 && productoSelect.value) {
                    this.value = 1;
                }
            });

            cantidadServicio.addEventListener('change', function() {
                if (this.value < 1 && servicioSelect.value) {
                    this.value = 1;
                }
            });

            // Efecto de terminal parpadeante
            const cursor = document.createElement('span');
            cursor.className = 'cr-effect';
            cursor.innerHTML = '█';
            cursor.style.animation = 'blink 1s infinite';
            document.querySelector('.cyber-footer').appendChild(cursor);

            // Inicializar estado del formulario
            updateFormState();
            updatePreviews();
        });
    </script>
}